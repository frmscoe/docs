# ArangoDB Clustering Performance Report

**Summary:**

This report presents the findings from the recent performance testing focused on the ArangoDB clustering capabilities. The tests were designed to evaluate the efficiency of read and write operations within a clustered environment, using JMeter as the tool to generate the workload. The main points of consideration were the processing times for read queries, CPU utilization on Azure nodes, write operation throughput and impact of scaling operations. 

**Test Environment:**

- ArangoDB Cluster vs singe deployment test
- Cluster Configuration: Initially 3 nodes with 96 vCPUs; scaled to 4 nodes
- Load Testing Tool: Apache JMeter
- Deployment: Azure Kubernetes Service (AKS)

**Test Execution:**
1.	**Cluster Configuration & Metrics:**
- The ArangoDB cluster was initially set up with 3 Azure nodes, each with 96 vCPUs. Due to performance concerns (maxing CPU), an additional node was added to the cluster.
- Metrics were gathered from the ArangoDB dashboard, showing CPU usage and other performance-related statistics.
2.	**Read Queries Performance:**
- Processing times for read queries were found to be slow, which correlated with high CPU utilization, causing the cluster to max out the CPU resources causing E2E to be extremely slow.
- The Azure metrics indicated that as the CPU load increased, the read operation latencies also increased, leading to performance bottlenecks.
3.	**Write Operations Performance:**
- JMeter tests showed that write operations to ArangoDB were completed quickly, with an ingestion rate of 2500 to 2700 messages per second.
- All transactions were submitted to the Transaction Monitoring Service (TMS) within a 10-second timeframe, indicating that the writes were not affected by the issues impacting read operations.
4.	**Database Scaling:**
- To address the performance issues, the database instances were scaled from 3 to 4.
- An additional Azure node was provisioned to host the new database instance, aimed at distributing the load and improving read query performance.
5.	**Network Topology Optimization:**
- The typologies were changed from 26 to 7  to improve the performance of the Typology Processor, Transaction Aggregatorand Decision Processor.
- This change was made in response to the observed delays in rule processing.
6.	**Performance Bottlenecks:**
- The Azure results screenshots and attached images show that the rules were taking an extended time to process, which contributed to system latency.
7.	**Indexing Efficiency:**
- There is a suspicion that the indexing strategies used in the clustered deployment of ArangoDB may not be as efficient as those in single-node deployments, possibly contributing to the slow read operations.

**Conclusions and Recommendations:** 

The performance test results indicate that while ArangoDB is capable of handling high volumes of write operations efficiently, read queries present a significant challenge when under heavy CPU load. The clustering mechanism, while scalable, shows signs of read performance degradation, which can be attributed to CPU saturation and possibly suboptimal indexing strategies.

**To mitigate these issues, the following actions are recommended:**
- **Further Investigation:** Detailed analysis of query execution plans and indexing strategies to identify specific causes of read query delays.
- **Index Optimization:** Review and optimize indexes for the clustered environment.
- **Continuous Scaling:** Consider additional scaling strategies, including vertical scaling of nodes and further cluster expansion.

**Attachments and Supporting Documents:**
- ArangoDB Dashboard screenshots
- JMeter test results
- Azure performance metrics screenshots
- JSON files with detailed performance metrics

**Processor Results**

<pre language="json">
  {
   "result":[
      {
         "startTime":"2024-03-28T13:15:02.515Z",
         "endTime":"2024-03-28T13:21:34.415Z",
         "amount":105000,
         "elapsed":392,
         "ftps":267.85714285714283,
         "TMSStats":[
            {
               "mn":11.161476,
               "mx":784.881829,
               "ave":44.457376340466666,
               "mea":35.301096,
               "ninety":65.690024,
               "ninetynine":238.222998
            }
         ],
         "CRSPStats":[
            {
               "mn":0.052501,
               "mx":90.344961,
               "ave":0.1183132763047619,
               "mea":0.091403,
               "ninety":0.136903,
               "ninetynine":0.225001
            }
         ],
         "TPStats":[
            {
               "mn":0.044501,
               "mx":227.472723,
               "ave":1.0041135019003553,
               "mea":0.2078085,
               "ninety":0.405313,
               "ninetynine":22.309186
            }
         ],
         "TADPStats":[
            {
               "mn":0.952624,
               "mx":31.293195,
               "ave":1.7074791166190477,
               "mea":1.5033215,
               "ninety":2.148924,
               "ninetynine":5.691743
            }
         ]
      }
   ],
   "hasMore":false,
   "cached":false,
   "extra":{
      "warnings":[
         
      ],
      "stats":{
         "writesExecuted":0,
         "writesIgnored":0,
         "scannedFull":525000,
         "scannedIndex":0,
         "cursorsCreated":0,
         "cursorsRearmed":0,
         "cacheHits":0,
         "cacheMisses":0,
         "filtered":0,
         "httpRequests":464,
         "executionTime":5.608667502001481,
         "peakMemoryUsage":20611072,
         "intermediateCommits":0
      }
   },
   "error":false,
   "code":201
}
</pre>
<pre language="json">
  {
   "result":[
      {
         "startTime":"2024-03-28T13:30:58.796Z",
         "endTime":"2024-03-28T13:37:35.462Z",
         "amount":105000,
         "elapsed":397,
         "ftps":264.4836272040302,
         "TMSStats":[
            {
               "mn":7.525951,
               "mx":922.721903,
               "ave":42.66358546847619,
               "mea":35.1078355,
               "ninety":59.306448,
               "ninetynine":201.375115
            }
         ],
         "CRSPStats":[
            {
               "mn":0.052402,
               "mx":75.595687,
               "ave":0.12098821221904763,
               "mea":0.092802,
               "ninety":0.135903,
               "ninetynine":0.190901
            }
         ],
         "TPStats":[
            {
               "mn":0.041901,
               "mx":3.698223,
               "ave":0.18482163925187034,
               "mea":0.1740025,
               "ninety":0.272412,
               "ninetynine":0.459916
            }
         ],
         "TADPStats":[
            {
               "mn":0.898524,
               "mx":19.25505,
               "ave":1.5823704247142856,
               "mea":1.424517,
               "ninety":1.981621,
               "ninetynine":4.650432
            }
         ]
      }
   ],
   "hasMore":false,
   "cached":false,
   "extra":{
      "warnings":[
         
      ],
      "stats":{
         "writesExecuted":0,
         "writesIgnored":0,
         "scannedFull":525000,
         "scannedIndex":0,
         "cursorsCreated":0,
         "cursorsRearmed":0,
         "cacheHits":0,
         "cacheMisses":0,
         "filtered":0,
         "httpRequests":460,
         "executionTime":5.415963553998154,
         "peakMemoryUsage":22478848,
         "intermediateCommits":0
      }
   },
   "error":false,
   "code":201
}
</pre>

**Typology Results**
<pre language="json">
  [
   [
      {
         "typologyId":"028@1.0.0",
         "pcrgTm":{
            "mn":0.0809,
            "mx":173.323064,
            "ave":0.17915340543809524
         }
      },
      {
         "typologyId":"037@1.0.0",
         "pcrgTm":{
            "mn":0.082301,
            "mx":51.316129,
            "ave":0.18326360012380954
         }
      },
      {
         "typologyId":"044@1.0.0",
         "pcrgTm":{
            "mn":0.072701,
            "mx":227.472723,
            "ave":0.16496033053333334
         }
      },
      {
         "typologyId":"047@1.0.0",
         "pcrgTm":{
            "mn":0.059501,
            "mx":93.978671,
            "ave":0.1400642595047619
         }
      },
      {
         "typologyId":"095@1.0.0",
         "pcrgTm":{
            "mn":0.044501,
            "mx":58.545856,
            "ave":0.11184044790476191
         }
      },
      {
         "typologyId":"185@1.0.0",
         "pcrgTm":{
            "mn":0.0487,
            "mx":45.958193,
            "ave":0.1327220721047619
         }
      }
   ]
]
</pre>
<pre language="json">
  [
   [
      {
         "typologyId":"028@1.0.0",
         "pcrgTm":{
            "mn":0.079802,
            "mx":3.140593,
            "ave":0.13958241032380952
         }
      },
      {
         "typologyId":"037@1.0.0",
         "pcrgTm":{
            "mn":0.080601,
            "mx":3.142096,
            "ave":0.13970823563809523
         }
      },
      {
         "typologyId":"044@1.0.0",
         "pcrgTm":{
            "mn":0.070701,
            "mx":3.303908,
            "ave":0.12228206685714285
         }
      },
      {
         "typologyId":"047@1.0.0",
         "pcrgTm":{
            "mn":0.062301,
            "mx":3.698223,
            "ave":0.10018067380000001
         }
      },
      {
         "typologyId":"095@1.0.0",
         "pcrgTm":{
            "mn":0.041901,
            "mx":3.031201,
            "ave":0.07591413400000001
         }
      },
      {
         "typologyId":"185@1.0.0",
         "pcrgTm":{
            "mn":0.047101,
            "mx":3.589418,
            "ave":0.09026867119047619
         }
      }
   ]
]
</pre>

**Rule Results**
<pre language="json">
  [
   [
      {
         "ruleId":"001@1.0.0",
         "pcrgTm":{
            "mn":21.339329,
            "mx":477.944352,
            "ave":31.018268044314283
         }
      },
      {
         "ruleId":"003@1.0.0",
         "pcrgTm":{
            "mn":21.251544,
            "mx":479.191989,
            "ave":31.27721671644762
         }
      },
      {
         "ruleId":"004@1.0.0",
         "pcrgTm":{
            "mn":21.196905,
            "mx":632.200569,
            "ave":31.784640084695237
         }
      },
      {
         "ruleId":"006@1.0.0",
         "pcrgTm":{
            "mn":10.112267,
            "mx":1890.12736,
            "ave":32.08764193958095
         }
      },
      {
         "ruleId":"007@1.0.0",
         "pcrgTm":{
            "mn":3.443925,
            "mx":388.36693,
            "ave":12.292808402133332
         }
      },
      {
         "ruleId":"008@1.0.0",
         "pcrgTm":{
            "mn":3.334114,
            "mx":388.354584,
            "ave":11.91420699017143
         }
      },
      {
         "ruleId":"010@1.0.0",
         "pcrgTm":{
            "mn":3.46432,
            "mx":392.207443,
            "ave":12.08402534009524
         }
      },
      {
         "ruleId":"011@1.0.0",
         "pcrgTm":{
            "mn":3.310315,
            "mx":385.887765,
            "ave":11.608750075838094
         }
      },
      {
         "ruleId":"016@1.0.0",
         "pcrgTm":{
            "mn":3.296412,
            "mx":389.765371,
            "ave":12.231460185247618
         }
      },
      {
         "ruleId":"017@1.0.0",
         "pcrgTm":{
            "mn":3.463321,
            "mx":388.35382,
            "ave":12.029514692600001
         }
      },
      {
         "ruleId":"018@1.0.0",
         "pcrgTm":{
            "mn":14.6859,
            "mx":424.734618,
            "ave":23.893470054828573
         }
      },
      {
         "ruleId":"020@1.0.0",
         "pcrgTm":{
            "mn":10.117864,
            "mx":1912.486291,
            "ave":31.999277784495238
         }
      },
      {
         "ruleId":"021@1.0.0",
         "pcrgTm":{
            "mn":9.851964,
            "mx":1890.124356,
            "ave":32.06444890569524
         }
      },
      {
         "ruleId":"024@1.0.0",
         "pcrgTm":{
            "mn":3.802119,
            "mx":4294.829683,
            "ave":32.89448468813333
         }
      },
      {
         "ruleId":"026@1.0.0",
         "pcrgTm":{
            "mn":1.091464,
            "mx":4287.654347,
            "ave":32.624640254219045
         }
      },
      {
         "ruleId":"030@1.0.0",
         "pcrgTm":{
            "mn":3.311405,
            "mx":387.761816,
            "ave":12.34420683167619
         }
      },
      {
         "ruleId":"044@1.0.0",
         "pcrgTm":{
            "mn":3.305615,
            "mx":389.716295,
            "ave":11.770290693657143
         }
      },
      {
         "ruleId":"045@1.0.0",
         "pcrgTm":{
            "mn":3.378215,
            "mx":387.589307,
            "ave":12.150647252380953
         }
      },
      {
         "ruleId":"048@1.0.0",
         "pcrgTm":{
            "mn":10.159074,
            "mx":414.097193,
            "ave":18.420412353095237
         }
      },
      {
         "ruleId":"063@1.0.0",
         "pcrgTm":{
            "mn":10.098665,
            "mx":410.466732,
            "ave":18.883096074190476
         }
      },
      {
         "ruleId":"076@1.0.0",
         "pcrgTm":{
            "mn":3.401697,
            "mx":387.712515,
            "ave":12.557480001428571
         }
      },
      {
         "ruleId":"083@1.0.0",
         "pcrgTm":{
            "mn":3.344814,
            "mx":388.261316,
            "ave":12.69584471432381
         }
      },
      {
         "ruleId":"084@1.0.0",
         "pcrgTm":{
            "mn":3.130007,
            "mx":389.044047,
            "ave":12.513733201704762
         }
      }
   ]
]
</pre>

<pre language="json">
  [
   [
      {
         "ruleId":"001@1.0.0",
         "pcrgTm":{
            "mn":21.392369,
            "mx":776.231998,
            "ave":31.32945970465714
         }
      },
      {
         "ruleId":"003@1.0.0",
         "pcrgTm":{
            "mn":21.440985,
            "mx":778.777175,
            "ave":32.3440573710381
         }
      },
      {
         "ruleId":"004@1.0.0",
         "pcrgTm":{
            "mn":21.152663,
            "mx":767.317377,
            "ave":31.306244314961905
         }
      },
      {
         "ruleId":"006@1.0.0",
         "pcrgTm":{
            "mn":10.151482,
            "mx":2030.684397,
            "ave":32.32946094691429
         }
      },
      {
         "ruleId":"007@1.0.0",
         "pcrgTm":{
            "mn":3.453696,
            "mx":636.700504,
            "ave":12.457782804895238
         }
      },
      {
         "ruleId":"008@1.0.0",
         "pcrgTm":{
            "mn":3.267281,
            "mx":635.356175,
            "ave":12.557751136561905
         }
      },
      {
         "ruleId":"010@1.0.0",
         "pcrgTm":{
            "mn":3.352423,
            "mx":637.366123,
            "ave":13.002233980619048
         }
      },
      {
         "ruleId":"011@1.0.0",
         "pcrgTm":{
            "mn":3.250219,
            "mx":635.340887,
            "ave":11.70264975747619
         }
      },
      {
         "ruleId":"016@1.0.0",
         "pcrgTm":{
            "mn":3.24039,
            "mx":634.069046,
            "ave":12.183998341857142
         }
      },
      {
         "ruleId":"017@1.0.0",
         "pcrgTm":{
            "mn":3.402584,
            "mx":638.59988,
            "ave":12.676839050361906
         }
      },
      {
         "ruleId":"018@1.0.0",
         "pcrgTm":{
            "mn":14.578591,
            "mx":753.388747,
            "ave":24.87659235520952
         }
      },
      {
         "ruleId":"020@1.0.0",
         "pcrgTm":{
            "mn":10.044415,
            "mx":2025.032002,
            "ave":32.132249957238095
         }
      },
      {
         "ruleId":"021@1.0.0",
         "pcrgTm":{
            "mn":10.007269,
            "mx":2034.604899,
            "ave":32.42278760831429
         }
      },
      {
         "ruleId":"024@1.0.0",
         "pcrgTm":{
            "mn":3.667936,
            "mx":4293.391405,
            "ave":35.9169174460381
         }
      },
      {
         "ruleId":"026@1.0.0",
         "pcrgTm":{
            "mn":4.782916,
            "mx":4294.219848,
            "ave":36.4896787284
         }
      },
      {
         "ruleId":"030@1.0.0",
         "pcrgTm":{
            "mn":3.284214,
            "mx":637.090915,
            "ave":12.275286463133334
         }
      },
      {
         "ruleId":"044@1.0.0",
         "pcrgTm":{
            "mn":3.331982,
            "mx":637.016113,
            "ave":12.042566271361904
         }
      },
      {
         "ruleId":"045@1.0.0",
         "pcrgTm":{
            "mn":3.444328,
            "mx":636.593884,
            "ave":12.602838461200001
         }
      },
      {
         "ruleId":"048@1.0.0",
         "pcrgTm":{
            "mn":10.063772,
            "mx":739.655676,
            "ave":18.856577709657145
         }
      },
      {
         "ruleId":"063@1.0.0",
         "pcrgTm":{
            "mn":10.034572,
            "mx":736.91501,
            "ave":18.674327010342857
         }
      },
      {
         "ruleId":"076@1.0.0",
         "pcrgTm":{
            "mn":3.296081,
            "mx":635.388283,
            "ave":13.008618317723808
         }
      },
      {
         "ruleId":"083@1.0.0",
         "pcrgTm":{
            "mn":3.304015,
            "mx":637.017334,
            "ave":12.434934702209523
         }
      },
      {
         "ruleId":"084@1.0.0",
         "pcrgTm":{
            "mn":3.389799,
            "mx":635.764099,
            "ave":12.602416828438097
         }
      }
   ]
]
</pre>

[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/9KzF4SYgdZQzTZP2-image-1711637399105.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/9KzF4SYgdZQzTZP2-image-1711637399105.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/ZaLMV9XLKFfBY63x-image-1711637399098.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/ZaLMV9XLKFfBY63x-image-1711637399098.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/C5HzHYMfT2B1FuBV-image-1711637399094.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/C5HzHYMfT2B1FuBV-image-1711637399094.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/I9Z4FjhzJMdyltC5-image-1711637399090.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/I9Z4FjhzJMdyltC5-image-1711637399090.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/BJwBg3nTCz7Z7Jz8-image-1711637399084.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/BJwBg3nTCz7Z7Jz8-image-1711637399084.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/hTLClKZhESwhMxYT-image-1711637399080.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/hTLClKZhESwhMxYT-image-1711637399080.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/PQZEZvyHuZAc9zVw-image-1711637399076.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/PQZEZvyHuZAc9zVw-image-1711637399076.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/0AP3XKjUHH1sAvli-image-1711637399071.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/0AP3XKjUHH1sAvli-image-1711637399071.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/VIkdVJZAcsiMIPUn-image-1711637399066.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/VIkdVJZAcsiMIPUn-image-1711637399066.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/eBC5EbD15YsaCLjI-image-1711637399062.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/eBC5EbD15YsaCLjI-image-1711637399062.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/fvyD43NdIiRxRtP4-image-1711637399058.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/fvyD43NdIiRxRtP4-image-1711637399058.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/fIlZJKkZ7LqF8prT-image-1711637399052.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/fIlZJKkZ7LqF8prT-image-1711637399052.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/q1dncssEmkjFtqH1-image-1711637399046.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/q1dncssEmkjFtqH1-image-1711637399046.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/z1w4QvTBTrxkgUJ7-image-1711637399038.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/z1w4QvTBTrxkgUJ7-image-1711637399038.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/S8pPThc8LKRp1GEv-image-1711637399033.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/S8pPThc8LKRp1GEv-image-1711637399033.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/SrVDzzc1udo5tUbS-image-1711637399028.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/SrVDzzc1udo5tUbS-image-1711637399028.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/koSYwoKk5pAsJcuk-image-1711637399023.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/koSYwoKk5pAsJcuk-image-1711637399023.PNG)[![](https://developer.sybrin.com/uploads/images/gallery/2024-03/scaled-1680-/Bn1ziyoIX4SXDjFb-image-1711637399011.PNG)](https://developer.sybrin.com/uploads/images/gallery/2024-03/Bn1ziyoIX4SXDjFb-image-1711637399011.PNG)